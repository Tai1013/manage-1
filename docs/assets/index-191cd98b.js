import{n as Z}from"./element-plus-1-40dc3ac7.js";import{a as J,_ as I,u as Q}from"./index.vuevuetypescriptsetuptruelang-83f252d4.js";import{M as x,A as L,a as X,t as _,g as ee,P as N}from"./index-e8d3887f.js";import{C as ae,z as le,D as M,d as te,e as R,f as q,g as re,F as ne,h as D,i as oe,G as ie,H as se}from"./element-plus-0-0e213acb.js";import{B as F,R as de,K as H,_ as j,d as S,r as w,M as u,O as h,Y as v,a2 as p,Z as g,az as k,z as d,a8 as T,a3 as b,a7 as y,a6 as O,P as $,x as B,ag as ue,a9 as C,L as ce,V as fe,bf as me,bg as pe,w as be,ae as he,aV as ge,T as V}from"./vendor-8bf8be11.js";/* empty css                                                      */import{_ as U}from"./plugin-vueexport-helper-c27b6911.js";import{g as ve}from"./operateServer-4ce2a9ab.js";import"./firebase-4680dd54.js";const Y="register",W="deregister",A=(e,i)=>{const r=[];H(Y+e,l=>{r.push(l)});const t=()=>{i==null||i(),j(()=>{r.forEach(l=>l())})};return H(W+e,l=>{const a=r.findIndex(n=>l===n);a!==-1&&r.splice(a,1)}),t},P=e=>{const i=F(Y+e,()=>{}),r=F(W+e,()=>{}),t=[];return de(()=>{t.forEach(l=>r(l))}),l=>{i(l),t.push(l)}},ye={key:0,class:"breadcrumb"},$e={key:0},ke={key:1},we={name:"Breadcrumb"},Se=S({...we,setup(e){const{route:i}=J(),r=w(i.path.split("/").splice(1)),t=w([]),l=(a,n)=>{a?t.value.push({title:a.title||a.label,name:n}):t.value.push({title:"",name:n})};try{const a=x.find(n=>n.name===r.value[0]);r.value.forEach((n,c)=>{if(a)c===0&&l(a,n),c===1&&l(a.child.find(s=>s.name===n),n),c===2&&l(L.find(s=>s.value===n),n);else throw Error()})}catch{t.value=[]}return(a,n)=>t.value.length>0?(u(),h("div",ye,[v(d(ae),{"separator-icon":d(Z)},{default:p(()=>[(u(!0),h(g,null,k(t.value,(c,s)=>(u(),h(g,{key:c.name},[s===0||s===t.value.length-1?(u(),b(d(M),{key:0},{default:p(()=>[d(i).name===c.name?(u(),h("b",$e,y(a.$t(`page.${c.title}`)),1)):(u(),h("span",ke,y(a.$t(`page.${c.title}`)),1))]),_:2},1024)):(u(),b(d(M),{key:1,to:{name:c.name}},{default:p(()=>[O(y(a.$t(`page.${c.title}`)),1)]),_:2},1032,["to"]))],64))),128))]),_:1},8,["separator-icon"]),v(d(le))])):T("",!0)}}),Te=U(Se,[["__scopeId","data-v-662c100a"]]),Ce=e=>{e.component&&["date-picker"].includes(e.component)?e.fieldStyle="field-time":e.fieldStyle="field-default"},ze=e=>(e.map(i=>Ce(i)),e),Ee={name:"FieldComp"},Oe=S({...Ee,props:{search:{type:Object,required:!0},field:{type:Object,required:!0}},setup(e){const i=(t,l)=>{if(l.onChange)return l.onChange({value:t,field:l})},r=t=>t.value?t.value:t;return(t,l)=>!e.field.component||e.field.component==="input"?(u(),b(d(te),$({key:0,modelValue:e.search[e.field.prop],"onUpdate:modelValue":l[0]||(l[0]=a=>e.search[e.field.prop]=a)},e.field.componentAttr,{clearable:e.field.clearable,disabled:e.field.disabled,size:e.field.size,placeholder:e.field.placeholder?t.$t(`placeholder.${e.field.placeholder}`):t.$t("placeholder.請輸入"),onChange:l[1]||(l[1]=a=>i(a,e.field))}),null,16,["modelValue","clearable","disabled","size","placeholder"])):e.field.component==="select"?(u(),b(d(q),$({key:1,modelValue:e.search[e.field.prop],"onUpdate:modelValue":l[2]||(l[2]=a=>e.search[e.field.prop]=a)},e.field.componentAttr,{clearable:e.field.clearable,disabled:e.field.disabled,size:e.field.size,placeholder:e.field.placeholder?t.$t(`placeholder.${e.field.placeholder}`):t.$t("placeholder.請選擇"),onChange:l[3]||(l[3]=a=>i(a,e.field))}),{default:p(()=>[(u(!0),h(g,null,k(r(e.field.options),a=>(u(),b(d(R),{key:a.value,label:a.label,value:a.value,disabled:a.disabled},null,8,["label","value","disabled"]))),128))]),_:1},16,["modelValue","clearable","disabled","size","placeholder"])):e.field.component==="select-group"?(u(),b(d(q),$({key:2,modelValue:e.search[e.field.prop],"onUpdate:modelValue":l[4]||(l[4]=a=>e.search[e.field.prop]=a)},e.field.componentAttr,{clearable:e.field.clearable,disabled:e.field.disabled,size:e.field.size,placeholder:e.field.placeholder?t.$t(`placeholder.${e.field.placeholder}`):t.$t("placeholder.請選擇"),onChange:l[5]||(l[5]=a=>i(a,e.field))}),{default:p(()=>[(u(!0),h(g,null,k(r(e.field.options),a=>(u(),b(d(re),{key:a.label,label:a.label},{default:p(()=>[(u(!0),h(g,null,k(r(a.options),n=>(u(),b(d(R),{key:n.value,label:n.label,value:n.value,disabled:n.disabled},null,8,["label","value","disabled"]))),128))]),_:2},1032,["label"]))),128))]),_:1},16,["modelValue","clearable","disabled","size","placeholder"])):e.field.component==="date-picker"?(u(),b(d(ne),$({key:3,class:"date-picker",modelValue:e.search[e.field.prop],"onUpdate:modelValue":l[6]||(l[6]=a=>e.search[e.field.prop]=a)},e.field.componentAttr,{type:e.field.type,"value-format":"YYYY-MM-DD HH:mm:ss","default-time":[new Date(0,0,0,0,0,0),new Date(0,0,0,23,59,59)],placeholder:e.field.placeholder?t.$t(`placeholder.${e.field.placeholder}`):t.$t("placeholder.請選擇"),"start-placeholder":t.$t("placeholder.開始時間"),"end-placeholder":t.$t("placeholder.結束時間"),clearable:e.field.clearable,disabled:e.field.disabled,size:e.field.size,onChange:l[7]||(l[7]=a=>i(a,e.field))}),null,16,["modelValue","type","default-time","placeholder","start-placeholder","end-placeholder","clearable","disabled","size"])):T("",!0)}}),G=e=>(me("data-v-115da10d"),e=e(),pe(),e),Ve={key:0,class:"label-required"},Le=G(()=>C("div",{class:"error-hide"},null,-1)),Be=G(()=>C("div",{class:"empty-label"},null,-1)),Ie={name:"MrcSearch"},Me=S({...Ie,props:{search:{type:Object,required:!0},fields:{type:Array,required:!0},size:{type:String,default:"default"},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["submit","clear"],setup(e,{emit:i}){const r=e,{$message:t}=X(),l=w(),a=B(()=>ze(r.fields)),n=o=>{if(o)return o.required},c=()=>{l.value&&l.value.validate((o,f)=>{if(o)i("submit");else{if(!f)return;Object.keys(f).forEach(m=>{const z=r.fields.find(E=>E.prop===m);if(z&&z.label){const E=l.value?" ":"";t.error(_(z.label)+E+f[m][0].message)}})}})},s=()=>{l.value&&(l.value.resetFields(),i("clear"))};return(o,f)=>(u(),b(d(oe),$({ref_key:"searchRef",ref:l},o.$attrs,{model:e.search,"label-position":"top",inline:"",disabled:e.disabled||e.loading,size:e.size,onSubmit:f[2]||(f[2]=ue(()=>{},["prevent"]))}),{default:p(()=>[(u(!0),h(g,null,k(d(a),m=>(u(),h(g,{key:m.prop},[m.visible!==!1?(u(),b(d(D),{key:0,prop:m.prop,rules:m.rules},{label:p(()=>[C("span",null,y(m.label?o.$t(m.label):""),1),n(m.rules)?(u(),h("span",Ve,"("+y(o.$t("validate.必填"))+")",1)):T("",!0)]),error:p(()=>[Le]),default:p(()=>[ce(o.$slots,`field:${m.prop}`,{field:m},()=>[C("div",{class:fe(m.fieldStyle)},[v(Oe,{search:e.search,field:m},null,8,["search","field"])],2)],!0)]),_:2},1032,["prop","rules"])):T("",!0)],64))),128)),v(d(D),{class:"search-button"},{default:p(()=>[Be,v(d(I),{type:"primary",onClick:f[0]||(f[0]=m=>c())},{default:p(()=>[O(y(o.$t("搜尋")),1)]),_:1}),v(d(I),{onClick:f[1]||(f[1]=m=>s())},{default:p(()=>[O(y(o.$t("清除")),1)]),_:1})]),_:1})]),_:3},16,["model","disabled","size"]))}}),Re=U(Me,[["__scopeId","data-v-115da10d"]]),qe={name:"MrcTable"},De=S({...qe,props:{data:{type:Array,required:!0},columns:{type:Array,required:!0},stripe:{type:Boolean,default:!1},border:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},setup(e){const i=e,r=w(void 0),t=w(0),l=()=>{var s;const a=document.querySelector(".main-view"),n=(s=document.querySelector(".main-view"))==null?void 0:s.children,c=o=>{if(r.value===void 0)return 0;let f=0;return f+=window.getComputedStyle(o).marginTop.num(),f+=window.getComputedStyle(o).marginBottom.num(),f+=window.getComputedStyle(o).height.num(),f};if(n){for(let o=0;o<n.length;o++)n[o].className.indexOf("el-table")>-1&&t.value++;if(t.value===1&&a){r.value=0,r.value=c(a)-61;for(let o=0;o<n.length;o++)n[o].className.indexOf("el-table")<0&&(r.value-=c(n[o]))}}};return be(()=>i.data,()=>{r.value=void 0,t.value=0,l(),j(()=>{r.value&&r.value<=360&&(r.value=360)})},{immediate:!0}),(a,n)=>{const c=ge("loading");return he((u(),b(d(ie),$(a.$attrs,{data:e.data,stripe:e.stripe,border:e.border,"max-height":r.value}),{default:p(()=>[(u(!0),h(g,null,k(e.columns,s=>{var o,f,m;return u(),h(g,{key:s.prop},[s.visible!==!1?(u(),b(d(se),$({key:0},s.attrs,{prop:s.prop,label:s.label,"min-width":((o=s.attrs)==null?void 0:o.minWidth)||80,fixed:(f=s.attrs)==null?void 0:f.fixed,align:(m=s.attrs)==null?void 0:m.align,formatter:s.formatter,sortable:s.sortable}),null,16,["prop","label","min-width","fixed","align","formatter","sortable"])):T("",!0)],64)}),128))]),_:1},16,["data","stripe","border","max-height"])),[[c,e.loading]])}}}),K=()=>{const e=V([{label:"登入",value:"login"}]),i=V(L.filter(t=>t.operate));return x.forEach(t=>{const l=t.child.filter(a=>a.operate).map(a=>({label:a.title,value:a.name}));e.push(...l)}),{pageList:e,operateTypeList:i,pageListFormatter:(t,l,a,n)=>{const c=e.find(s=>s.value===a);return c?c.label:"錯誤"}}},Fe=(e,i,r,t)=>ee({date:r}),He=(e,i,r,t)=>{const l=L.find(a=>a.value===r);return l?l.label:"錯誤"},Ae=(e,i,r,t)=>{const l=N.find(a=>a.value===r);return l?l.label:"錯誤"},Pe=e=>{const{load:i,unload:r,isLoading:t}=Q(),{pageListFormatter:l}=K(),a=w([]),n=B(()=>[{prop:"platform",label:"站台",formatter:Ae},{prop:"page",label:"頁面",formatter:l,attrs:{align:"center"}},{prop:"operateType",label:"操作類型",formatter:He,attrs:{align:"center"}},{prop:"operateTime",label:"操作時間",formatter:Fe,sortable:!0,attrs:{minWidth:180}},{prop:"account",label:"帳號",attrs:{minWidth:150}},{prop:"ip",label:"IP",attrs:{minWidth:130}}]);return{data:a,columns:n,isLoading:t,reset:()=>{a.value=[]},getOperateRecordList:async()=>{i(),await ve(e).then(o=>a.value=o.data).finally(()=>r())}}},xe=S({__name:"table",props:{search:{type:Object,required:!0}},setup(e){const i=e,{data:r,columns:t,isLoading:l,getOperateRecordList:a,reset:n}=Pe(i.search);return P("submit")(()=>{n(),a()}),P("clear")(()=>{n()}),(o,f)=>(u(),b(d(De),{data:d(r),columns:d(t),loading:d(l)},null,8,["data","columns","loading"]))}}),Qe=S({__name:"index",setup(e){const{pageList:i,operateTypeList:r}=K(),t=V({platform:"",account:"",page:"",operateType:"",operateTime:[]}),l=B(()=>[{prop:"platform",label:"站台",component:"select",options:N,clearable:!0},{prop:"account",label:"帳號",clearable:!0},{prop:"page",label:"頁面",component:"select",options:i,clearable:!0},{prop:"operateType",label:"操作類型",component:"select",options:r,clearable:!0},{prop:"operateTime",label:"操作時間",component:"date-picker",type:"daterange",clearable:!0}]),a=A("submit"),n=A("clear");return(c,s)=>(u(),h(g,null,[v(d(Te)),v(d(Re),{search:t,fields:d(l),onSubmit:s[0]||(s[0]=o=>d(a)()),onClear:s[1]||(s[1]=o=>d(n)())},null,8,["search","fields"]),v(xe,{search:t},null,8,["search"])],64))}});export{Qe as default};
